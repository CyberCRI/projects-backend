# Generated by Django 4.2.25 on 2025-10-08 16:28

from django.conf import settings
import django.contrib.postgres.fields
from django.db import migrations, models
import django.db.models.deletion
import django.db.models.functions.text


class Migration(migrations.Migration):

    initial = True

    dependencies = [
        migrations.swappable_dependency(settings.AUTH_USER_MODEL),
    ]

    operations = [
        migrations.CreateModel(
            name="Identifier",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "harvester",
                    models.CharField(
                        choices=[
                            ("hal", "Hal"),
                            ("scanr", "Scanr"),
                            ("openalex", "Openalex"),
                            ("idref", "Idref"),
                            ("scopus", "Scopus"),
                            ("orcid", "Orcid"),
                            ("local", "Local"),
                            ("eppn", "Eppn"),
                        ],
                        max_length=50,
                    ),
                ),
                ("value", models.CharField(max_length=255)),
            ],
        ),
        migrations.CreateModel(
            name="Publication",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "crisalid_uid",
                    models.CharField(
                        blank=True, db_index=True, max_length=255, null=True
                    ),
                ),
                ("title", models.TextField()),
                ("description", models.TextField(default="")),
                ("publication_date", models.DateField(null=True)),
                (
                    "publication_type",
                    models.CharField(
                        blank=True,
                        choices=[
                            ("Audiovisual Document", "Audiovisual Document"),
                            ("Blog Post", "Blog Post"),
                            ("Book", "Book"),
                            ("Book Review", "Book Review"),
                            ("BookChapter", "Bookchapter"),
                            ("Chapter", "Chapter"),
                            ("ConferenceArticle", "Conferencearticle"),
                            ("Conference Output", "Conference Output"),
                            ("Conference Paper", "Conference Paper"),
                            ("Conference Poster", "Conference Poster"),
                            ("Data Management Plan", "Data Management Plan"),
                            ("Data Paper", "Data Paper"),
                            ("Dataset", "Dataset"),
                            ("Reference Book", "Dictionary"),
                            ("Document", "Document"),
                            ("Editorial", "Editorial"),
                            ("Erratum", "Erratum"),
                            ("Grant", "Grant"),
                            ("Image", "Image"),
                            ("JournalArticle", "Journalarticle"),
                            ("Lecture", "Lecture"),
                            ("Letter", "Letter"),
                            ("Manual", "Manual"),
                            ("Map", "Map"),
                            ("Master Thesis", "Master Thesis"),
                            ("Metadata Document", "Metadata Document"),
                            ("Note", "Note"),
                            ("Other", "Other"),
                            ("Patent", "Patent"),
                            ("Peer review", "Peer Review"),
                            ("Preprint", "Preprint"),
                            ("Proceedings", "Proceedings"),
                            ("Report", "Report"),
                            ("Research Report", "Research Report"),
                            ("Review Paper", "Review"),
                            ("Review Article", "Review Article"),
                            ("Software", "Software"),
                            ("Standard", "Standard"),
                            ("Still Image", "Still Image"),
                            ("Technical Report", "Technical Report"),
                            ("Thesis", "Thesis"),
                            ("Working Paper", "Working Paper"),
                            ("Unknown", "Unknown"),
                        ],
                        max_length=50,
                        null=True,
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="Researcher",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "crisalid_uid",
                    models.CharField(
                        blank=True, db_index=True, max_length=255, null=True
                    ),
                ),
                (
                    "display_name",
                    models.CharField(blank=True, max_length=200, null=True),
                ),
                (
                    "identifiers",
                    models.ManyToManyField(
                        related_name="researchers", to="crisalid.identifier"
                    ),
                ),
                (
                    "user",
                    models.OneToOneField(
                        null=True,
                        on_delete=django.db.models.deletion.CASCADE,
                        related_name="researcher",
                        to=settings.AUTH_USER_MODEL,
                    ),
                ),
            ],
            options={
                "abstract": False,
            },
        ),
        migrations.CreateModel(
            name="PublicationContributor",
            fields=[
                (
                    "id",
                    models.BigAutoField(
                        auto_created=True,
                        primary_key=True,
                        serialize=False,
                        verbose_name="ID",
                    ),
                ),
                (
                    "roles",
                    django.contrib.postgres.fields.ArrayField(
                        base_field=models.CharField(
                            choices=[
                                ("FMO", "former owner"),
                                ("AUE", "audio engineer"),
                                ("DSR", "designer"),
                                ("SPK", "speaker"),
                                ("BPD", "bookplate designer"),
                                ("DIS", "dissertant"),
                                ("PRN", "production company"),
                                ("MUS", "musician"),
                                ("COR", "collection registrar"),
                                ("BKA", "book artist"),
                                ("RSE", "respondent-appellee"),
                                ("PTF", "plaintiff"),
                                ("EGR", "engraver"),
                                ("CCP", "conceptor"),
                                ("GIS", "geographic information specialist"),
                                ("PRT", "printer"),
                                ("APP", "applicant"),
                                ("CPC", "copyright claimant"),
                                ("LIL", "libelant"),
                                ("APE", "appellee"),
                                ("HNR", "honoree"),
                                ("CPT", "complainant-appellant"),
                                ("ORM", "organizer"),
                                ("BRL", "braille embosser"),
                                ("ADP", "adapter"),
                                ("WIN", "writer of introduction"),
                                ("LTG", "lithographer"),
                                ("FND", "funder"),
                                ("CRR", "corrector"),
                                ("VAC", "voice actor"),
                                ("WDE", "wood engraver"),
                                ("ANM", "animator"),
                                ("MON", "monitor"),
                                ("ELT", "electrotyper"),
                                ("ASN", "associated name"),
                                ("TLP", "television producer"),
                                ("ORG", "originator"),
                                ("SGD", "stage director"),
                                ("COM", "compiler"),
                                ("CRE", "creator"),
                                ("INS", "inscriber"),
                                ("MFR", "manufacturer"),
                                ("MOD", "moderator"),
                                ("CMP", "composer"),
                                ("DTC", "data contributor"),
                                ("FMD", "film director"),
                                ("PRC", "process contact"),
                                ("SCE", "scenarist"),
                                ("CLI", "client"),
                                ("DLN", "delineator"),
                                ("COS", "contestant"),
                                ("PRO", "producer"),
                                ("TAD", "technical advisor"),
                                ("TYD", "type designer"),
                                ("TRL", "translator"),
                                ("PMN", "production manager"),
                                ("MTK", "minute taker"),
                                ("ANN", "annotator"),
                                ("PBL", "publisher"),
                                ("TAU", "television writer"),
                                ("LEL", "libelee"),
                                ("WAW", "writer of afterword"),
                                ("ARR", "arranger"),
                                ("AUP", "audio producer"),
                                ("CST", "costume designer"),
                                ("ENJ", "enacting jurisdiction"),
                                ("MTE", "metal engraver"),
                                ("TLD", "television director"),
                                ("WAL", "writer of added lyrics"),
                                ("CPH", "copyright holder"),
                                ("CHR", "choreographer"),
                                ("LSE", "licensee"),
                                ("MDC", "metadata contact"),
                                ("REV", "reviewer"),
                                ("STL", "storyteller"),
                                ("CLT", "collotyper"),
                                ("ILL", "illustrator"),
                                ("IVR", "interviewer"),
                                ("ARC", "architect"),
                                ("CTS", "contestee"),
                                ("LEE", "libelee-appellee"),
                                ("ADI", "art director"),
                                ("ANT", "bibliographic antecedent"),
                                ("ELG", "electrician"),
                                ("OSP", "onscreen presenter"),
                                ("RCP", "addressee"),
                                ("ANC", "announcer"),
                                ("PBD", "publisher director"),
                                ("ATT", "attributed name"),
                                ("DRM", "draftsman"),
                                ("PRG", "programmer"),
                                ("ILU", "illuminator"),
                                ("LDR", "laboratory director"),
                                ("SDE", "sound engineer"),
                                ("STM", "stage manager"),
                                ("TLH", "television host"),
                                ("SNG", "singer"),
                                ("WAM", "writer of accompanying material"),
                                ("SLL", "seller"),
                                ("RSR", "restorationist"),
                                ("ABR", "abridger"),
                                ("DTO", "dedicator"),
                                ("HST", "host"),
                                ("PRM", "printmaker"),
                                ("RSG", "restager"),
                                ("CNS", "censor"),
                                ("RCD", "recordist"),
                                ("CTB", "contributor"),
                                ("RTH", "research team head"),
                                ("PAT", "patron"),
                                ("AUD", "author of dialog"),
                                ("SRV", "surveyor"),
                                ("TCH", "teacher"),
                                ("UVP", "university place"),
                                ("WPR", "writer of preface"),
                                ("WFW", "writer of foreword"),
                                ("PRS", "production designer"),
                                ("ART", "artist"),
                                ("MCP", "music copyist"),
                                ("PAN", "panelist"),
                                ("STG", "setting"),
                                ("APL", "appellant"),
                                ("MFP", "manufacture place"),
                                ("PTE", "plaintiff-appellee"),
                                ("EDM", "editor of moving image work"),
                                ("ACT", "actor"),
                                ("WIT", "witness"),
                                ("RPT", "reporter"),
                                ("STN", "standards body"),
                                ("IVE", "interviewee"),
                                ("VFX", "visual effects provider"),
                                ("AUI", "author of introduction, etc."),
                                ("LSA", "landscape architect"),
                                ("AUC", "auctioneer"),
                                ("SGN", "signer"),
                                ("CTT", "contestee-appellant"),
                                ("PDR", "project director"),
                                ("CNG", "cinematographer"),
                                ("JUD", "judge"),
                                ("LED", "lead"),
                                ("BRD", "broadcaster"),
                                ("COL", "collector"),
                                ("DFE", "defendant-appellee"),
                                ("OWN", "owner"),
                                ("CMT", "compositor"),
                                ("NRT", "narrator"),
                                ("LIT", "libelant-appellant"),
                                ("DNC", "dancer"),
                                ("ETR", "etcher"),
                                ("FLM", "film editor"),
                                ("LBT", "librettist"),
                                ("RPC", "radio producer"),
                                ("EXP", "expert"),
                                ("RCE", "recording engineer"),
                                ("SHT", "supporting host"),
                                ("DTE", "dedicatee"),
                                ("RBR", "rubricator"),
                                ("COE", "contestant-appellee"),
                                ("COU", "court governed"),
                                ("DRT", "director"),
                                ("PRA", "praeses"),
                                ("AUT", "author"),
                                ("ITR", "instrumentalist"),
                                ("MXE", "mixing engineer"),
                                ("DBP", "distribution place"),
                                ("DGG", "degree granting institution"),
                                ("MSD", "musical director"),
                                ("RPY", "responsible party"),
                                ("SPN", "sponsor"),
                                ("JUG", "jurisdiction governed"),
                                ("DJO", "dj"),
                                ("CSP", "consultant to a project"),
                                ("RST", "respondent-appellant"),
                                ("BDD", "binding designer"),
                                ("RDD", "radio director"),
                                ("CUR", "curator"),
                                ("MUP", "music programmer"),
                                ("EDD", "editorial director"),
                                ("CPL", "complainant"),
                                ("BKD", "book designer"),
                                ("LEN", "lender"),
                                ("THS", "thesis advisor"),
                                ("WAC", "writer of added commentary"),
                                ("SFX", "special effects provider"),
                                ("AFT", "author of afterword, colophon, etc."),
                                ("CWT", "commentator for written text"),
                                ("LET", "libelee-appellant"),
                                ("PAD", "place of address"),
                                ("PFR", "proofreader"),
                                ("CLR", "colorist"),
                                ("AQT", "author in quotations or text abstracts"),
                                ("DGS", "degree supervisor"),
                                ("BND", "binder"),
                                ("LYR", "lyricist"),
                                ("REN", "renderer"),
                                ("SPY", "second party"),
                                ("MRK", "markup editor"),
                                ("DFD", "defendant"),
                                ("PRF", "performer"),
                                ("ATO", "autographer"),
                                ("HIS", "host institution"),
                                ("DUB", "dubious author"),
                                ("FON", "founder"),
                                ("STD", "set designer"),
                                ("PTH", "patent holder"),
                                ("TCD", "technical director"),
                                ("INV", "inventor"),
                                ("TYG", "typographer"),
                                ("ASG", "assignee"),
                                ("COP", "camera operator"),
                                ("WAT", "writer of added text"),
                                ("AUS", "screenwriter"),
                                ("CMM", "commentator"),
                                ("ARD", "artistic director"),
                                ("BSL", "bookseller"),
                                ("EDT", "editor"),
                                ("BKP", "book producer"),
                                ("CLL", "calligrapher"),
                                ("CTG", "cartographer"),
                                ("PTT", "plaintiff-appellant"),
                                ("RTM", "research team member"),
                                ("VDG", "videographer"),
                                ("WDC", "woodcutter"),
                                ("ENG", "engineer"),
                                ("MKA", "makeup artist"),
                                ("CTR", "contractor"),
                                ("RES", "researcher"),
                                ("CAD", "casting director"),
                                ("COV", "cover designer"),
                                ("FRG", "forger"),
                                ("TRC", "transcriber"),
                                ("CPE", "complainant-appellee"),
                                ("INK", "inker"),
                                ("TLG", "television guest"),
                                ("POP", "printer of plates"),
                                ("DBD", "dubbing director"),
                                ("PNC", "penciller"),
                                ("RPS", "repository"),
                                ("FDS", "film distributor"),
                                ("LSO", "licensor"),
                                ("RED", "redaktor"),
                                ("DGC", "degree committee member"),
                                ("PPT", "puppeteer"),
                                ("STR", "stereotyper"),
                                ("DFT", "defendant-appellant"),
                                ("CRP", "correspondent"),
                                ("ISB", "issuing body"),
                                ("RAP", "rapporteur"),
                                ("CON", "conservator"),
                                ("WST", "writer of supplementary textual content"),
                                ("SCR", "scribe"),
                                ("ACP", "art copyist"),
                                ("SWD", "software developer"),
                                ("VOC", "vocalist"),
                                ("LBR", "laboratory"),
                                ("CSL", "consultant"),
                                ("SAD", "scientific advisor"),
                                ("DPT", "depositor"),
                                ("BJD", "bookjacket designer"),
                                ("SDS", "sound designer"),
                                ("EDC", "editor of compilation"),
                                ("DPC", "depicted"),
                                ("FAC", "facsimilist"),
                                ("BLW", "blurb writer"),
                                ("DST", "distributor"),
                                ("LIE", "libelant-appellee"),
                                ("COT", "contestant-appellant"),
                                ("ONP", "onscreen participant"),
                                ("PRP", "production place"),
                                ("SCL", "sculptor"),
                                ("FMP", "film producer"),
                                ("CAS", "caster"),
                                ("SEC", "secretary"),
                                ("WFT", "writer of intertitles"),
                                ("WTS", "writer of television story"),
                                ("PRV", "provider"),
                                ("OTH", "other"),
                                ("LGD", "lighting designer"),
                                ("PUP", "publication place"),
                                ("PLT", "platemaker"),
                                ("MRB", "marbler"),
                                ("CTE", "contestee-appellee"),
                                ("FLD", "field director"),
                                ("WFS", "writer of film story"),
                                ("ANL", "analyst"),
                                ("OPN", "opponent"),
                                ("PMA", "permitting agency"),
                                ("RXA", "remix artist"),
                                ("PHT", "photographer"),
                                ("PRE", "presenter"),
                                ("PTA", "patent applicant"),
                                ("DNR", "donor"),
                                ("MED", "medium"),
                                ("EVP", "event place"),
                                ("CND", "conductor"),
                                ("GDV", "game developer"),
                                ("DTM", "data manager"),
                                ("LTR", "letterer"),
                                ("PPM", "papermaker"),
                                ("FPY", "first party"),
                                ("RSP", "respondent"),
                                ("CRT", "court reporter"),
                                ("FMK", "filmmaker"),
                                ("NAN", "news anchor"),
                                ("PRD", "production personnel"),
                            ],
                            max_length=255,
                        ),
                        default=list,
                        size=None,
                    ),
                ),
                (
                    "publication",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to="crisalid.publication",
                    ),
                ),
                (
                    "researcher",
                    models.ForeignKey(
                        on_delete=django.db.models.deletion.CASCADE,
                        to="crisalid.researcher",
                    ),
                ),
            ],
        ),
        migrations.AddField(
            model_name="publication",
            name="contributors",
            field=models.ManyToManyField(
                related_name="publications",
                through="crisalid.PublicationContributor",
                to="crisalid.researcher",
            ),
        ),
        migrations.AddField(
            model_name="publication",
            name="identifiers",
            field=models.ManyToManyField(
                related_name="publications", to="crisalid.identifier"
            ),
        ),
        migrations.AddConstraint(
            model_name="identifier",
            constraint=models.UniqueConstraint(
                django.db.models.functions.text.Lower("harvester"),
                django.db.models.functions.text.Lower("value"),
                name="unique_harvester",
            ),
        ),
        migrations.AddConstraint(
            model_name="researcher",
            constraint=models.UniqueConstraint(
                models.F("crisalid_uid"), name="crisalid_researcher_unique_crisalid_uid"
            ),
        ),
        migrations.AddConstraint(
            model_name="publicationcontributor",
            constraint=models.UniqueConstraint(
                fields=("publication", "researcher"),
                name="unique_researcher_publication",
            ),
        ),
        migrations.AddConstraint(
            model_name="publication",
            constraint=models.UniqueConstraint(
                models.F("crisalid_uid"),
                name="crisalid_publication_unique_crisalid_uid",
            ),
        ),
    ]
